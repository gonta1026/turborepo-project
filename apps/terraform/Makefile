

help:
	@echo "ğŸš€ Terraform æ“ä½œã‚³ãƒãƒ³ãƒ‰"
	@echo ""
	@echo "ğŸ“‹ ä½¿ç”¨å¯èƒ½ãªã‚³ãƒãƒ³ãƒ‰:"
	@echo "  make help              - ã“ã®ãƒ˜ãƒ«ãƒ—ã‚’è¡¨ç¤º"
	@echo "  make init-all          - å…¨ç’°å¢ƒã®terraform init"
	@echo ""
	@echo "ğŸ—„ï¸ ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰è¨­å®š:"
	@echo "  make setup-gcs-backend - GCSãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ç”¨ãƒã‚±ãƒƒãƒˆã‚’ä½œæˆ"
	@echo "  make migrate-to-gcs    - ãƒ­ãƒ¼ã‚«ãƒ«çŠ¶æ…‹ã‚’GCSã«ç§»è¡Œ"
	@echo ""
	@echo "ğŸ”§ Devç’°å¢ƒ:"
	@echo "  make plan-dev          - devç’°å¢ƒã®plan"
	@echo "  make apply-dev         - devç’°å¢ƒã®apply"
	@echo "  make destroy-dev       - devç’°å¢ƒã®destroy"
	@echo ""
	
# GCSãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ç”¨ãƒã‚±ãƒƒãƒˆã®ä½œæˆ
setup-gcs-backend:
	@echo "ğŸ—„ï¸ GCS ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ç”¨ãƒã‚±ãƒƒãƒˆã‚’ä½œæˆã—ã¾ã™..."
	cd gcp/backend && terraform init
	cd gcp/backend && terraform plan
	cd gcp/backend && terraform apply
	@echo "âœ… GCSãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰è¨­å®šå®Œäº†"

# ãƒ­ãƒ¼ã‚«ãƒ«çŠ¶æ…‹ã‚’GCSã«ç§»è¡Œ
migrate-to-gcs:
	@echo "ğŸ”„ ãƒ­ãƒ¼ã‚«ãƒ«çŠ¶æ…‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’GCSã«ç§»è¡Œã—ã¾ã™..."
	@echo "âš ï¸  ç§»è¡Œå‰ã«æ—¢å­˜ã® terraform.tfstate ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’ä½œæˆã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã—ã¾ã™"
	cd gcp/environments/dev/setup && cp terraform.tfstate terraform.tfstate.backup 2>/dev/null || true
	cd gcp/environments/dev/setup && terraform init -migrate-state
	@echo "âœ… çŠ¶æ…‹ãƒ•ã‚¡ã‚¤ãƒ«ã®ç§»è¡Œå®Œäº†"

# å…¨ç’°å¢ƒã®åˆæœŸåŒ–
init-all:
	@echo "ğŸ”§ å…¨ç’°å¢ƒã®terraform initã‚’å®Ÿè¡Œã—ã¾ã™..."
	cd gcp/environments/dev/setup && terraform init
	@echo "âœ… åˆæœŸåŒ–å®Œäº†"

# Devç’°å¢ƒ
plan-dev:
	@echo "ğŸ”§ Devç’°å¢ƒã®planã‚’å®Ÿè¡Œã—ã¾ã™..."
	cd gcp/environments/dev/setup && terraform plan && cd ../../..

apply-dev:
	@echo "ğŸš€ Devç’°å¢ƒã«applyã—ã¾ã™..."
	cd gcp/environments/dev/setup && terraform apply && cd ../../..

destroy-dev:
	@echo "ğŸ—‘ï¸ Devç’°å¢ƒã‚’å‰Šé™¤ã—ã¾ã™..."
	cd gcp/environments/dev/setup && terraform destroy && cd ../../..



	
	


	
	


	
	